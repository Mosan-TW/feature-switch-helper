{"version":3,"file":"deep-object.utils.js","sourceRoot":"/","sources":["src/utils/deep-object.utils.ts"],"names":[],"mappings":"AASA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4CG;AACH,MAAM,UAAU,SAAS,CAAI,KAAQ,EAAE,OAA0B;IAC/D,MAAM,EAAE,SAAS,EAAE,wBAAwB,GAAG,IAAI,EAAE,GAAG,OAAO,IAAI,EAAE,CAAA;IACpE,OAAO,UAAU,CAAC,KAAK,EAAE,SAAS,EAAE,wBAAwB,CAAC,CAAC,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;AAClF,CAAC;AAED,SAAS,UAAU,CACjB,KAAQ,EACR,SAA0E,EAC1E,YAAwC;IAExC,cAAc;IACd,IAAI,KAAK,KAAK,IAAI,EAAE,CAAC;QACnB,MAAM,cAAc,GAAG,SAAS,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;QAC7C,IAAI,cAAc,EAAE,CAAC;YACnB,OAAO,cAAc,CAAC,KAAK,CAAC,CAAA;QAC9B,CAAC;QACD,OAAO,KAAK,CAAA;IACd,CAAC;IACD,yBAAyB;IACzB,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC9B,MAAM,mBAAmB,GAAG,SAAS,EAAE,GAAG,CAAC,OAAO,KAAK,CAAC,CAAA;QACxD,IAAI,mBAAmB,EAAE,CAAC;YACxB,OAAO,mBAAmB,CAAC,KAAK,CAAC,CAAA;QACnC,CAAC;QACD,OAAO,KAAK,CAAA;IACd,CAAC;IACD,4BAA4B;IAC5B,IAAI,SAA2C,CAAA;IAC/C,wDAAwD;IACxD,SAAS,GAAG,YAAY,EAAE,GAAG,CAAC,KAAK,CAAqC,CAAA;IACxE,IAAI,SAAS,EAAE,CAAC;QACd,OAAO,SAAc,CAAA;IACvB,CAAC;IACD,MAAM,UAAU,GAAG,SAAS,EAAE,GAAG,CAAC,KAAK,CAAC,WAA0B,CAAC,IAAI,SAAS,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAA;IAC/F,IAAI,UAAU,EAAE,CAAC;QACf,SAAS,GAAG,UAAU,CAAC,KAAK,CAAC,CAAA;IAC/B,CAAC;SAAM,CAAC;QACN,4CAA4C;QAC5C,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,CAAA;QACnF,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE,CAAC;YACxB,SAAU,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,SAAS,EAAE,YAAY,CAAC,CAAA;QACnE,CAAC;IACH,CAAC;IACD,YAAY,EAAE,GAAG,CAAC,KAAK,EAAE,SAAU,CAAC,CAAA;IACpC,OAAO,SAAc,CAAA;AACvB,CAAC;AAED;;;;;;;;GAQG;AACH,MAAM,UAAU,UAAU,CAAI,GAAM;IAClC,IAAI,GAAG,KAAK,IAAI,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,CAAC;QAC5C,OAAO,GAAG,CAAA;IACZ,CAAC;IACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;QAC1B,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;IACpB,CAAC;IACD,MAAM,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;QAC7C,MAAM,KAAK,GAAI,GAAW,CAAC,IAAI,CAAC,CAAA;QAChC,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;YACvC,UAAU,CAAC,KAAK,CAAC,CAAA;QACnB,CAAC;IACH,CAAC,CAAC,CAAA;IACF,OAAO,GAAG,CAAA;AACZ,CAAC","sourcesContent":["type Constructor = new (...args: any[]) => any\ntype ClonerFunc<T = any> = (obj: T) => T\ntype TypeofValue = 'string' | 'number' | 'boolean' | 'bigint' | 'symbol' | 'undefined' | 'object' | 'function'\n\nexport interface DeepCloneOptions {\n  clonerMap?: Map<Constructor | TypeofValue | 'null', ClonerFunc>\n  handleCircularReferences?: boolean\n}\n\n/**\n * Deep clones a value using a provided cloning map.\n *\n * By default (without a cloner map), it performs a deep clone for objects and arrays,\n * and returns primitive values as is.\n *\n * If the value is an instance of a class, it will be cloned by creating a\n * new instance and copying properties.\n *\n * If a cloner map is provided, it will use the corresponding cloner function\n * for the type or constructor.\n *\n * ## Cloner map for objects\n * Please note that Object (class) and 'object' (typeof) are treated differently\n * in the cloner map.\n *\n * Object only matches instances of the Object class (created via 'new Object()'\n * or object literals),\n *\n * while 'object' matches all objects (including arrays, null, instances of custom classes,\n * Object instances and object literals).\n *\n * It is recommended to use Object class cloner instead of 'object' type cloner\n * as it is less ambiguous.\n *\n * ## Cloner precedence\n * If there are more than one applicable cloner for a value, the one with narrower\n * scope is applied first.\n *\n * Here are some examples:\n * - For a plain object, if both Object class and 'object' type cloners are provided,\n *   the Object class cloner will be used.\n * - For a null value, if both 'null' type and 'object' type cloners are provided,\n *   the 'null' type cloner will be used.\n * - For an array, if both Array class and 'object' type cloners are provided,\n *   the Array class cloner will be used.\n *\n * @param value The value to clone.\n * @param options Cloning options.\n * - options.clonerMap: A map of cloner functions for specific types or constructors.\n * - options.handleCircularReferences: Whether to handle circular references. Defaults to true.\n * Disable this option to improve performance if you are sure there are no circular references.\n * @returns The cloned value.\n * @author Andrash Yang\n */\nexport function deepClone<T>(value: T, options?: DeepCloneOptions): T {\n  const { clonerMap, handleCircularReferences = true } = options || {}\n  return _deepClone(value, clonerMap, handleCircularReferences ? new Map() : null)\n}\n\nfunction _deepClone<T>(\n  value: T,\n  clonerMap: Map<Constructor | TypeofValue | 'null', ClonerFunc> | undefined,\n  clonedObjMap: Map<object, object> | null,\n): T {\n  // Handle null\n  if (value === null) {\n    const nullClonerFunc = clonerMap?.get('null')\n    if (nullClonerFunc) {\n      return nullClonerFunc(value)\n    }\n    return value\n  }\n  // Handle primitive types\n  if (typeof value !== 'object') {\n    const primitiveClonerFunc = clonerMap?.get(typeof value)\n    if (primitiveClonerFunc) {\n      return primitiveClonerFunc(value)\n    }\n    return value\n  }\n  // Handle objects and arrays\n  let clonedObj: Record<keyof T, any> | undefined\n  // Check if already cloned to handle circular references\n  clonedObj = clonedObjMap?.get(value) as Record<keyof T, any> | undefined\n  if (clonedObj) {\n    return clonedObj as T\n  }\n  const clonerFunc = clonerMap?.get(value.constructor as Constructor) || clonerMap?.get('object')\n  if (clonerFunc) {\n    clonedObj = clonerFunc(value)\n  } else {\n    // Default deep clone for objects and arrays\n    clonedObj = Array.isArray(value) ? [] : Object.create(Object.getPrototypeOf(value))\n    for (const key in value) {\n      clonedObj![key] = _deepClone(value[key], clonerMap, clonedObjMap)\n    }\n  }\n  clonedObjMap?.set(value, clonedObj!)\n  return clonedObj as T\n}\n\n/**\n * Deep freezes an object recursively.\n *\n * Will not re-freeze already frozen objects.\n * Will return the original value if it's not an object.\n * @param obj Object to be frozen\n * @returns Frozen object\n * @author Andrash Yang\n */\nexport function deepFreeze<T>(obj: T): Readonly<T> {\n  if (obj === null || typeof obj !== 'object') {\n    return obj\n  }\n  if (!Object.isFrozen(obj)) {\n    Object.freeze(obj)\n  }\n  Object.getOwnPropertyNames(obj).forEach(prop => {\n    const value = (obj as any)[prop]\n    if (value && typeof value === 'object') {\n      deepFreeze(value)\n    }\n  })\n  return obj\n}\n"]}